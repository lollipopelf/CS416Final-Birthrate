<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Birthrate and GDP Charts</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <svg id="birthRateChart" width="1200" height="300"></svg>
  <svg id="gdpChart" width="1200" height="300"></svg>

  <script>
    const parseYear = d3.timeParse("%Y");

    d3.csv("birthratecn.csv").then(function(birthData) {
      birthData = birthData
        .filter(d => d.year && d.birthrate)
        .map(d => ({
          year: parseYear(d.year),
          birthrate: +d.birthrate / 10  // 每千人 → 百分比
        }));

      d3.csv("gdp person.csv").then(function(gdpData) {
        gdpData = gdpData
          .filter(d => d.year && d.gdp)
          .map(d => ({
            year: parseYear(d.year),
            gdp: +d.gdp
          }));

        const margin = { top: 20, right: 30, bottom: 60, left: 70 },
              width = 1200 - margin.left - margin.right,
              height = 300 - margin.top - margin.bottom;

        // === Birthrate Chart ===
        const svgBirth = d3.select("#birthRateChart")
          .append("g")
          .attr("transform", `translate(${margin.left},${margin.top})`);

        const xBirth = d3.scaleTime()
          .domain(d3.extent(birthData, d => d.year))
          .range([0, width]);

        const yBirth = d3.scaleLinear()
          .domain([0, d3.max(birthData, d => d.birthrate)]).nice()
          .range([height, 0]);

        svgBirth.append("g")
          .attr("transform", `translate(0,${height})`)
          .call(
            d3.axisBottom(xBirth)
              .ticks(d3.timeYear.every(5))
              .tickFormat(d3.timeFormat("%Y"))
          )
          .selectAll("text")
          .attr("transform", "rotate(-45)")
          .style("text-anchor", "end");

        svgBirth.append("g")
          .call(d3.axisLeft(yBirth).tickFormat(d => d + "%"));

        svgBirth.append("path")
          .datum(birthData)
          .attr("fill", "none")
          .attr("stroke", "steelblue")
          .attr("stroke-width", 2)
          .attr("d", d3.line()
            .x(d => xBirth(d.year))
            .y(d => yBirth(d.birthrate))
          );

        svgBirth.append("text")
          .attr("x", width / 2)
          .attr("y", -10)
          .attr("text-anchor", "middle")
          .style("font-size", "14px")
          .text("Birth Rate (% of population)");

        // === GDP Chart ===
        const svgGdp = d3.select("#gdpChart")
          .append("g")
          .attr("transform", `translate(${margin.left},${margin.top})`);

        const xGdp = d3.scaleTime()
          .domain(d3.extent(gdpData, d => d.year))
          .range([0, width]);

        const yGdp = d3.scaleLinear()
          .domain([0, d3.max(gdpData, d => d.gdp)]).nice()
          .range([height, 0]);

        svgGdp.append("g")
          .attr("transform", `translate(0,${height})`)
          .call(
            d3.axisBottom(xGdp)
              .ticks(d3.timeYear.every(5))
              .tickFormat(d3.timeFormat("%Y"))
          )
          .selectAll("text")
          .attr("transform", "rotate(-45)")
          .style("text-anchor", "end");

        svgGdp.append("g")
          .call(d3.axisLeft(yGdp));

        svgGdp.append("path")
          .datum(gdpData)
          .attr("fill", "none")
          .attr("stroke", "orange")
          .attr("stroke-width", 2)
          .attr("d", d3.line()
            .x(d => xGdp(d.year))
            .y(d => yGdp(d.gdp))
          );

        svgGdp.append("text")
          .attr("x", width / 2)
          .attr("y", -10)
          .attr("text-anchor", "middle")
          .style("font-size", "14px")
          .text("GDP per Capita (USD)");
      });
    });
  </script>
</body>
</html>
